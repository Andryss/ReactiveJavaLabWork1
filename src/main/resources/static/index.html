<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spaceships Management System</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .main-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            margin: 20px auto;
            max-width: 1400px;
            min-height: calc(100vh - 100px);
        }
        
        .nav-tabs {
            border-bottom: 3px solid #667eea;
        }
        
        .nav-tabs .nav-link {
            color: #667eea;
            font-weight: 600;
            border: none;
            border-bottom: 3px solid transparent;
            padding: 15px 30px;
        }
        
        .nav-tabs .nav-link:hover {
            border-color: #667eea;
            background-color: #f8f9fa;
        }
        
        .nav-tabs .nav-link.active {
            color: #667eea;
            background-color: white;
            border-bottom-color: #667eea;
        }
        
        .tab-content {
            padding: 30px;
        }
        
        .status-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            background: white;
            border-radius: 25px;
            padding: 10px 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: grey;
            animation: pulse 2s infinite;
        }
        
        .status-dot.online {
            background-color: #28a745;
        }
        
        .status-dot.offline {
            background-color: #dc3545;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .card {
            border: none;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .card-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px 10px 0 0 !important;
            font-weight: 600;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #5568d3 0%, #653a91 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(220, 53, 69, 0.4);
        }
        
        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.4);
        }
        
        .table {
            border-radius: 10px;
            overflow: hidden;
        }
        
        .table thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .table tbody tr:hover {
            background-color: #f8f9fa;
        }
        
        .main-screen {
            text-align: center;
            padding: 60px 20px;
        }
        
        .main-screen h1 {
            color: #667eea;
            font-size: 3.5rem;
            font-weight: 700;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        .main-screen .gif-container {
            margin: 40px 0;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .main-screen .gif-container img {
            width: 100%;
            max-width: 500px;
            height: auto;
        }
        
        .form-control:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        }
        
        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .badge {
            padding: 6px 12px;
            border-radius: 20px;
        }
        
        .pagination {
            margin-top: 20px;
        }
        
        .page-link {
            color: #667eea;
        }
        
        .page-link:hover {
            color: #764ba2;
        }
        
        .page-item.active .page-link {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: #667eea;
        }
    </style>
</head>
<body>
    <!-- Server Status Indicator (Minimized) -->
    <div class="status-indicator">
        <div class="status-dot" id="statusDot"></div>
        <span id="statusText">Checking...</span>
    </div>

    <div class="main-container">
        <!-- Navigation Tabs -->
        <ul class="nav nav-tabs" id="mainTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="home-tab" data-bs-toggle="tab" data-bs-target="#home" type="button">
                    <i class="bi bi-house-door"></i> Home
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="spaceships-tab" data-bs-toggle="tab" data-bs-target="#spaceships" type="button">
                    <i class="bi bi-rocket"></i> Spaceships
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="staff-tab" data-bs-toggle="tab" data-bs-target="#staff" type="button">
                    <i class="bi bi-people"></i> Staff
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="requests-tab" data-bs-toggle="tab" data-bs-target="#requests" type="button">
                    <i class="bi bi-clipboard-check"></i> Requests
                </button>
            </li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content" id="mainTabContent">
            <!-- Home Tab -->
            <div class="tab-pane fade show active" id="home" role="tabpanel">
                <div class="main-screen">
                    <h1>ðŸš€ Spaceships Management System</h1>
                    <p class="lead text-muted">Manage your fleet, staff, and maintenance requests all in one place</p>
                    <div class="gif-container">
                        <img src="https://media.giphy.com/media/l0MYC0LajdoPo3ATu/giphy.gif" alt="Funny spaceship gif">
                    </div>
<div class="mt-4">
                        <p class="text-muted">Navigate through the tabs above to manage different aspects of your spaceship fleet.</p>
                    </div>
                </div>
            </div>

            <!-- Spaceships Tab -->
            <div class="tab-pane fade" id="spaceships" role="tabpanel">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="bi bi-rocket"></i> Spaceships Database</h5>
                    </div>
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h5>Spaceships List</h5>
                            <button class="btn btn-primary" onclick="showSpaceshipModal()">
                                <i class="bi bi-plus-circle"></i> Add Spaceship
                            </button>
                        </div>
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Serial</th>
                                        <th>Name</th>
                                        <th>Manufacturer</th>
                                        <th>Type</th>
                                        <th>Max Speed</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="spaceshipsTableBody">
                                    <tr>
                                        <td colspan="6" class="text-center">Loading...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <label>Page: </label>
                                <input type="number" id="spaceshipsPage" value="0" min="0" style="width: 60px;" onchange="loadSpaceships()">
                                <label class="ms-3">Size: </label>
                                <input type="number" id="spaceshipsSize" value="20" min="1" max="100" style="width: 60px;" onchange="loadSpaceships()">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Staff Tab -->
            <div class="tab-pane fade" id="staff" role="tabpanel">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="bi bi-people"></i> Staff Database</h5>
                    </div>
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h5>Repairmen List</h5>
                            <button class="btn btn-primary" onclick="showRepairmanModal()">
                                <i class="bi bi-plus-circle"></i> Add Repairman
                            </button>
                        </div>
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Name</th>
                                        <th>Position</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="repairmenTableBody">
                                    <tr>
                                        <td colspan="4" class="text-center">Loading...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <label>Page: </label>
                                <input type="number" id="repairmenPage" value="0" min="0" style="width: 60px;" onchange="loadRepairmen()">
                                <label class="ms-3">Size: </label>
                                <input type="number" id="repairmenSize" value="20" min="1" max="100" style="width: 60px;" onchange="loadRepairmen()">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Requests Tab -->
            <div class="tab-pane fade" id="requests" role="tabpanel">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="bi bi-clipboard-check"></i> Maintenance Requests Database</h5>
                    </div>
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h5>Maintenance Requests List</h5>
                            <button class="btn btn-primary" onclick="showRequestModal()">
                                <i class="bi bi-plus-circle"></i> Add Request
                            </button>
                        </div>
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Spaceship Serial</th>
                                        <th>Comment</th>
                                        <th>Status</th>
                                        <th>Assignee</th>
                                        <th>Created</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="requestsTableBody">
                                    <tr>
                                        <td colspan="7" class="text-center">Loading...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <label>Page: </label>
                                <input type="number" id="requestsPage" value="0" min="0" style="width: 60px;" onchange="loadRequests()">
                                <label class="ms-3">Size: </label>
                                <input type="number" id="requestsSize" value="20" min="1" max="100" style="width: 60px;" onchange="loadRequests()">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Spaceship Modal -->
    <div class="modal fade" id="spaceshipModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="spaceshipModalTitle">Add Spaceship</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" style="max-height: 80vh; overflow-y: auto;">
                    <form id="spaceshipForm">
                        <input type="hidden" id="spaceshipSerial" name="serial">
                        
                        <h6 class="mb-3 text-primary">Basic Information</h6>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Serial Number *</label>
                                <input type="number" class="form-control" id="spaceshipSerialInput" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Name *</label>
                                <input type="text" class="form-control" id="spaceshipName" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Manufacturer *</label>
                                <input type="text" class="form-control" id="spaceshipManufacturer" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Type *</label>
                                <select class="form-select" id="spaceshipType" required>
                                    <option value="">Select type</option>
                                    <option value="CARGO">CARGO</option>
                                    <option value="EXPLORATION">EXPLORATION</option>
                                    <option value="SCOUT">SCOUT</option>
                                    <option value="BATTLE">BATTLE</option>
                                    <option value="PASSENGER">PASSENGER</option>
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Manufacture Date *</label>
                                <input type="datetime-local" class="form-control" id="spaceshipManufactureDate" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Max Speed</label>
                                <input type="number" class="form-control" id="spaceshipMaxSpeed" value="0">
                            </div>
                        </div>
                        
                        <hr class="my-4">
                        <h6 class="mb-3 text-primary">Dimensions</h6>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Length (meters)</label>
                                <input type="number" class="form-control" id="dimensionsLength" value="0">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Width (meters)</label>
                                <input type="number" class="form-control" id="dimensionsWidth" value="0">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Height (meters)</label>
                                <input type="number" class="form-control" id="dimensionsHeight" value="0">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Weight (tons)</label>
                                <input type="number" step="0.01" class="form-control" id="dimensionsWeight" value="0">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Volume (cubic meters)</label>
                                <input type="number" step="0.01" class="form-control" id="dimensionsVolume" value="0">
                            </div>
                        </div>

                        <hr class="my-4">
                        <h6 class="mb-3 text-primary">Engine</h6>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Model</label>
                                <input type="text" class="form-control" id="engineModel">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Thrust (kN)</label>
                                <input type="number" class="form-control" id="engineThrust" value="0">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Fuel Type</label>
                                <select class="form-select" id="engineFuelType">
                                    <option value="">Select fuel type</option>
                                    <option value="LIQUID_HYDROGEN">LIQUID_HYDROGEN</option>
                                    <option value="KEROSENE">KEROSENE</option>
                                    <option value="METHANE">METHANE</option>
                                    <option value="ELECTRIC">ELECTRIC</option>
                                    <option value="NUCLEAR">NUCLEAR</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Fuel Consumption (per hour)</label>
                                <input type="number" step="0.01" class="form-control" id="engineFuelConsumption" value="0">
                            </div>
                        </div>
                        
                        <hr class="my-4">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h6 class="mb-0 text-primary">Crew Members</h6>
                            <button type="button" class="btn btn-sm btn-success" onclick="addCrewMember()">
                                <i class="bi bi-plus-circle"></i> Add Crew Member
                            </button>
                        </div>
                        <div id="crewMembersContainer">
                            <!-- Crew members will be added here dynamically -->
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveSpaceship()">Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Repairman Modal -->
    <div class="modal fade" id="repairmanModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="repairmanModalTitle">Add Repairman</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="repairmanForm">
                        <input type="hidden" id="repairmanId">
                        <div class="mb-3">
                            <label class="form-label">Name *</label>
                            <input type="text" class="form-control" id="repairmanName" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Position *</label>
                            <input type="text" class="form-control" id="repairmanPosition" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveRepairman()">Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Request Modal -->
    <div class="modal fade" id="requestModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="requestModalTitle">Add Maintenance Request</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="requestForm">
                        <input type="hidden" id="requestId">
                        <div class="mb-3">
                            <label class="form-label">Spaceship Serial *</label>
                            <input type="number" class="form-control" id="requestSpaceshipSerial" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Comment *</label>
                            <textarea class="form-control" id="requestComment" rows="3" required></textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Assignee (Repairman ID)</label>
                            <input type="number" class="form-control" id="requestAssignee">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Status</label>
                            <select class="form-select" id="requestStatus">
                                <option value="NEW">NEW</option>
                                <option value="ACCEPTED">ACCEPTED</option>
                                <option value="DIAGNOSTICS">DIAGNOSTICS</option>
                                <option value="APPROVAL">APPROVAL</option>
                                <option value="WAITING_PARTS">WAITING_PARTS</option>
                                <option value="IN_REPAIR">IN_REPAIR</option>
                                <option value="QUALITY_CHECK">QUALITY_CHECK</option>
                                <option value="READY_FOR_PICKUP">READY_FOR_PICKUP</option>
                                <option value="COMPLETED">COMPLETED</option>
                                <option value="CANCELLED">CANCELLED</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveRequest()">Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
        const API_BASE = 'http://localhost:8080';
        
        // Server Status Monitor
        const statusDot = document.getElementById('statusDot');
        const statusText = document.getElementById('statusText');
        
        function setStatus(online) {
            if (online) {
                statusDot.className = 'status-dot online';
                statusText.textContent = 'Online';
            } else {
                statusDot.className = 'status-dot offline';
                statusText.textContent = 'Offline';
            }
        }
        
        function startPingStream() {
            const evtSource = new EventSource(`${API_BASE}/pinger`);
            evtSource.onmessage = () => setStatus(true);
            evtSource.onerror = () => setStatus(false);
        }
        startPingStream();
        
        // Load data when tabs are shown
        document.getElementById('spaceships-tab').addEventListener('shown.bs.tab', loadSpaceships);
        document.getElementById('staff-tab').addEventListener('shown.bs.tab', loadRepairmen);
        document.getElementById('requests-tab').addEventListener('shown.bs.tab', loadRequests);
        
        // Spaceships Functions
        async function loadSpaceships() {
            const page = document.getElementById('spaceshipsPage').value || 0;
            const size = document.getElementById('spaceshipsSize').value || 20;
            try {
                const response = await fetch(`${API_BASE}/spaceships?page=${page}&size=${size}`);
                const data = await response.json();
                const tbody = document.getElementById('spaceshipsTableBody');
                tbody.innerHTML = data.map(ship => `
                    <tr>
                        <td>${ship.serial}</td>
                        <td>${ship.name || '-'}</td>
                        <td>${ship.manufacturer || '-'}</td>
                        <td><span class="badge bg-primary">${ship.type || '-'}</span></td>
                        <td>${ship.maxSpeed || 0}</td>
                        <td>
                            <button class="btn btn-sm btn-primary" onclick="editSpaceship(${ship.serial})">
                                <i class="bi bi-pencil"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteSpaceship(${ship.serial})">
                                <i class="bi bi-trash"></i>
                            </button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                document.getElementById('spaceshipsTableBody').innerHTML = 
                    '<tr><td colspan="6" class="text-center text-danger">Error loading spaceships</td></tr>';
            }
        }
        
        let crewMemberIndex = 0;
        
        function addCrewMember() {
            const container = document.getElementById('crewMembersContainer');
            const memberDiv = document.createElement('div');
            memberDiv.className = 'card mb-3';
            memberDiv.id = `crewMember-${crewMemberIndex}`;
            memberDiv.innerHTML = `
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h6 class="mb-0">Crew Member</h6>
                        <button type="button" class="btn btn-sm btn-danger" onclick="removeCrewMember(${crewMemberIndex})">
                            <i class="bi bi-trash"></i> Remove
                        </button>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-2">
                            <label class="form-label">Full Name</label>
                            <input type="text" class="form-control" id="crewFullName-${crewMemberIndex}">
                        </div>
                        <div class="col-md-6 mb-2">
                            <label class="form-label">Rank</label>
                            <input type="text" class="form-control" id="crewRank-${crewMemberIndex}">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-2">
                            <label class="form-label">Experience Years</label>
                            <input type="number" class="form-control" id="crewExperience-${crewMemberIndex}" value="0">
                        </div>
                        <div class="col-md-6 mb-2">
                            <label class="form-label">Birth Date</label>
                            <input type="date" class="form-control" id="crewBirthDate-${crewMemberIndex}">
                        </div>
                    </div>
                </div>
            `;
            container.appendChild(memberDiv);
            crewMemberIndex++;
        }
        
        function removeCrewMember(index) {
            const memberDiv = document.getElementById(`crewMember-${index}`);
            if (memberDiv) {
                memberDiv.remove();
            }
        }
        
        function showSpaceshipModal(serial = null) {
            document.getElementById('spaceshipModalTitle').textContent = serial ? 'Edit Spaceship' : 'Add Spaceship';
            document.getElementById('spaceshipSerial').value = serial || '';
            document.getElementById('spaceshipSerialInput').value = serial || '';
            document.getElementById('spaceshipSerialInput').disabled = !!serial;
            
            // Clear crew members container
            document.getElementById('crewMembersContainer').innerHTML = '';
            crewMemberIndex = 0;
            
            if (serial) {
                fetch(`${API_BASE}/spaceships/${serial}`)
                    .then(r => r.json())
                    .then(data => {
                        document.getElementById('spaceshipName').value = data.name || '';
                        document.getElementById('spaceshipManufacturer').value = data.manufacturer || '';
                        document.getElementById('spaceshipType').value = data.type || '';
                        document.getElementById('spaceshipMaxSpeed').value = data.maxSpeed || 0;
                        if (data.manufactureDate) {
                            const date = new Date(data.manufactureDate);
                            document.getElementById('spaceshipManufactureDate').value = 
                                date.toISOString().slice(0, 16);
                        }
                        
                        // Populate dimensions
                        if (data.dimensions) {
                            document.getElementById('dimensionsLength').value = data.dimensions.length || 0;
                            document.getElementById('dimensionsWidth').value = data.dimensions.width || 0;
                            document.getElementById('dimensionsHeight').value = data.dimensions.height || 0;
                            document.getElementById('dimensionsWeight').value = data.dimensions.weight || 0;
                            document.getElementById('dimensionsVolume').value = data.dimensions.volume || 0;
                        }
                        
                        // Populate engine
                        if (data.engine) {
                            document.getElementById('engineModel').value = data.engine.model || '';
                            document.getElementById('engineThrust').value = data.engine.thrust || 0;
                            document.getElementById('engineFuelType').value = data.engine.fuelType || '';
                            document.getElementById('engineFuelConsumption').value = data.engine.fuelConsumption || 0;
                        }
                        
                        // Populate crew
                        if (data.crew && data.crew.length > 0) {
                            data.crew.forEach(member => {
                                addCrewMember();
                                const index = crewMemberIndex - 1;
                                document.getElementById(`crewFullName-${index}`).value = member.fullName || '';
                                document.getElementById(`crewRank-${index}`).value = member.rank || '';
                                document.getElementById(`crewExperience-${index}`).value = member.experienceYears || 0;
                                if (member.birthDate) {
                                    const date = new Date(member.birthDate);
                                    document.getElementById(`crewBirthDate-${index}`).value = 
                                        date.toISOString().slice(0, 10);
                                }
                            });
                        }
                    });
            } else {
                document.getElementById('spaceshipForm').reset();
            }
            new bootstrap.Modal(document.getElementById('spaceshipModal')).show();
        }
        
        async function saveSpaceship() {
            const serial = document.getElementById('spaceshipSerial').value;
            const data = {
                serial: parseInt(document.getElementById('spaceshipSerialInput').value),
                name: document.getElementById('spaceshipName').value,
                manufacturer: document.getElementById('spaceshipManufacturer').value,
                type: document.getElementById('spaceshipType').value,
                maxSpeed: parseInt(document.getElementById('spaceshipMaxSpeed').value) || 0
            };
            
            const manufactureDate = document.getElementById('spaceshipManufactureDate').value;
            if (manufactureDate) {
                data.manufactureDate = new Date(manufactureDate).toISOString();
            }
            
            // Add dimensions
            const dimensionsLength = document.getElementById('dimensionsLength').value;
            const dimensionsWidth = document.getElementById('dimensionsWidth').value;
            const dimensionsHeight = document.getElementById('dimensionsHeight').value;
            const dimensionsWeight = document.getElementById('dimensionsWeight').value;
            const dimensionsVolume = document.getElementById('dimensionsVolume').value;
            
            if (dimensionsLength || dimensionsWidth || dimensionsHeight || dimensionsWeight || dimensionsVolume) {
                data.dimensions = {
                    length: parseInt(dimensionsLength) || 0,
                    width: parseInt(dimensionsWidth) || 0,
                    height: parseInt(dimensionsHeight) || 0,
                    weight: parseFloat(dimensionsWeight) || 0,
                    volume: parseFloat(dimensionsVolume) || 0
                };
            }
            
            // Add engine
            const engineModel = document.getElementById('engineModel').value;
            const engineThrust = document.getElementById('engineThrust').value;
            const engineFuelType = document.getElementById('engineFuelType').value;
            const engineFuelConsumption = document.getElementById('engineFuelConsumption').value;
            
            if (engineModel || engineThrust || engineFuelType || engineFuelConsumption) {
                data.engine = {
                    model: engineModel || '',
                    thrust: parseInt(engineThrust) || 0,
                    fuelType: engineFuelType || null,
                    fuelConsumption: parseFloat(engineFuelConsumption) || 0
                };
            }
            
            // Add crew
            const crew = [];
            for (let i = 0; i < crewMemberIndex; i++) {
                const memberDiv = document.getElementById(`crewMember-${i}`);
                if (memberDiv) {
                    const fullName = document.getElementById(`crewFullName-${i}`).value;
                    const rank = document.getElementById(`crewRank-${i}`).value;
                    const experience = document.getElementById(`crewExperience-${i}`).value;
                    const birthDate = document.getElementById(`crewBirthDate-${i}`).value;
                    
                    if (fullName || rank || experience || birthDate) {
                        const member = {
                            fullName: fullName || '',
                            rank: rank || '',
                            experienceYears: parseInt(experience) || 0
                        };
                        if (birthDate) {
                            member.birthDate = birthDate;
                        }
                        crew.push(member);
                    }
                }
            }
            if (crew.length > 0) {
                data.crew = crew;
            }
            
            const url = serial ? `${API_BASE}/spaceships/${serial}` : `${API_BASE}/spaceships`;
            const method = serial ? 'PUT' : 'POST';
            
            try {
                await fetch(url, {
                    method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                bootstrap.Modal.getInstance(document.getElementById('spaceshipModal')).hide();
                loadSpaceships();
            } catch (error) {
                alert('Error saving spaceship: ' + error);
            }
        }
        
        async function deleteSpaceship(serial) {
            if (!confirm('Are you sure you want to delete this spaceship?')) return;
            try {
                await fetch(`${API_BASE}/spaceships/${serial}`, { method: 'DELETE' });
                loadSpaceships();
            } catch (error) {
                alert('Error deleting spaceship: ' + error);
            }
        }
        
        function editSpaceship(serial) {
            showSpaceshipModal(serial);
        }
        
        // Repairmen Functions
        async function loadRepairmen() {
            const page = document.getElementById('repairmenPage').value || 0;
            const size = document.getElementById('repairmenSize').value || 20;
            try {
                const response = await fetch(`${API_BASE}/repairmen?page=${page}&size=${size}`);
                const data = await response.json();
                const tbody = document.getElementById('repairmenTableBody');
                tbody.innerHTML = data.map(repairman => `
                    <tr>
                        <td>${repairman.id}</td>
                        <td>${repairman.name}</td>
                        <td>${repairman.position}</td>
                        <td>
                            <button class="btn btn-sm btn-primary" onclick="editRepairman(${repairman.id})">
                                <i class="bi bi-pencil"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteRepairman(${repairman.id})">
                                <i class="bi bi-trash"></i>
                            </button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                document.getElementById('repairmenTableBody').innerHTML = 
                    '<tr><td colspan="4" class="text-center text-danger">Error loading repairmen</td></tr>';
            }
        }
        
        function showRepairmanModal(id = null) {
            document.getElementById('repairmanModalTitle').textContent = id ? 'Edit Repairman' : 'Add Repairman';
            document.getElementById('repairmanId').value = id || '';
            if (id) {
                fetch(`${API_BASE}/repairmen/${id}`)
                    .then(r => r.json())
                    .then(data => {
                        document.getElementById('repairmanName').value = data.name || '';
                        document.getElementById('repairmanPosition').value = data.position || '';
                    });
            } else {
                document.getElementById('repairmanForm').reset();
            }
            new bootstrap.Modal(document.getElementById('repairmanModal')).show();
        }
        
        async function saveRepairman() {
            const id = document.getElementById('repairmanId').value;
            const data = {
                name: document.getElementById('repairmanName').value,
                position: document.getElementById('repairmanPosition').value
            };
            
            const url = id ? `${API_BASE}/repairmen/${id}` : `${API_BASE}/repairmen`;
            const method = id ? 'PUT' : 'POST';
            
            try {
                await fetch(url, {
                    method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                bootstrap.Modal.getInstance(document.getElementById('repairmanModal')).hide();
                loadRepairmen();
            } catch (error) {
                alert('Error saving repairman: ' + error);
            }
        }
        
        async function deleteRepairman(id) {
            if (!confirm('Are you sure you want to delete this repairman?')) return;
            try {
                await fetch(`${API_BASE}/repairmen/${id}`, { method: 'DELETE' });
                loadRepairmen();
            } catch (error) {
                alert('Error deleting repairman: ' + error);
            }
        }
        
        function editRepairman(id) {
            showRepairmanModal(id);
        }
        
        // Requests Functions
        async function loadRequests() {
            const page = document.getElementById('requestsPage').value || 0;
            const size = document.getElementById('requestsSize').value || 20;
            try {
                const response = await fetch(`${API_BASE}/maintenance-requests?page=${page}&size=${size}`);
                const data = await response.json();
                const tbody = document.getElementById('requestsTableBody');
                tbody.innerHTML = data.map(req => `
                    <tr>
                        <td>${req.id}</td>
                        <td>${req.spaceshipSerial}</td>
                        <td>${req.comment || '-'}</td>
                        <td><span class="badge bg-info">${req.status || 'NEW'}</span></td>
                        <td>${req.assignee || '-'}</td>
                        <td>${req.createdAt ? new Date(req.createdAt).toLocaleString() : '-'}</td>
                        <td>
                            <button class="btn btn-sm btn-primary" onclick="editRequest(${req.id})">
                                <i class="bi bi-pencil"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteRequest(${req.id})">
                                <i class="bi bi-trash"></i>
                            </button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                document.getElementById('requestsTableBody').innerHTML = 
                    '<tr><td colspan="7" class="text-center text-danger">Error loading requests</td></tr>';
            }
        }
        
        function showRequestModal(id = null) {
            document.getElementById('requestModalTitle').textContent = id ? 'Edit Request' : 'Add Request';
            document.getElementById('requestId').value = id || '';
            if (id) {
                fetch(`${API_BASE}/maintenance-requests/${id}`)
                    .then(r => r.json())
                    .then(data => {
                        document.getElementById('requestSpaceshipSerial').value = data.spaceshipSerial || '';
                        document.getElementById('requestComment').value = data.comment || '';
                        document.getElementById('requestAssignee').value = data.assignee || '';
                        document.getElementById('requestStatus').value = data.status || 'NEW';
                    });
            } else {
                document.getElementById('requestForm').reset();
                document.getElementById('requestStatus').value = 'NEW';
            }
            new bootstrap.Modal(document.getElementById('requestModal')).show();
        }
        
        async function saveRequest() {
            const id = document.getElementById('requestId').value;
            const data = {
                spaceshipSerial: parseInt(document.getElementById('requestSpaceshipSerial').value),
                comment: document.getElementById('requestComment').value
            };
            
            if (id) {
                // On update, include all fields except createdAt/updatedAt
                const assignee = document.getElementById('requestAssignee').value;
                if (assignee) data.assignee = parseInt(assignee);
                data.status = document.getElementById('requestStatus').value;
            }
            
            const url = id ? `${API_BASE}/maintenance-requests/${id}` : `${API_BASE}/maintenance-requests`;
            const method = id ? 'PUT' : 'POST';
            
            try {
                await fetch(url, {
                    method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                bootstrap.Modal.getInstance(document.getElementById('requestModal')).hide();
                loadRequests();
            } catch (error) {
                alert('Error saving request: ' + error);
            }
        }
        
        async function deleteRequest(id) {
            if (!confirm('Are you sure you want to delete this request?')) return;
            try {
                await fetch(`${API_BASE}/maintenance-requests/${id}`, { method: 'DELETE' });
                loadRequests();
            } catch (error) {
                alert('Error deleting request: ' + error);
            }
        }
        
        function editRequest(id) {
            showRequestModal(id);
        }
</script>
</body>
</html>
